require 'sqlite3'

# Create a new SQLite3 database
db = SQLite3::Database.new 'malware_database.db'

# Create tables for malware samples and posts
db.execute <<-SQL
  CREATE TABLE IF NOT EXISTS malware_samples (
    id INTEGER PRIMARY KEY,
    name TEXT,
    type TEXT,
    description TEXT
  );
SQL

db.execute <<-SQL
  CREATE TABLE IF NOT EXISTS posts (
    id INTEGER PRIMARY KEY,
    name TEXT,
    description TEXT
  );
SQL

# Function to add a new malware sample
def add_malware_sample(db, name, type, description)
  db.execute("INSERT INTO malware_samples (name, type, description)
              VALUES (?, ?, ?)", [name, type, description])
rescue SQLite3::Exception => e
  puts "Error adding malware sample: #{e.message}"
end

# Function to search for malware by type
def search_malware_by_type(db, type)
  db.execute("SELECT * FROM malware_samples WHERE type = ?", [type]) do |row|
    puts "Name: #{row[1]}, Type: #{row[2]}, Description: #{row[3]}"
  end
rescue SQLite3::Exception => e
  puts "Error searching for malware: #{e.message}"
end

# Function to add a new post
def add_post(db, name, description)
  db.execute("INSERT INTO posts (name, description) VALUES (?, ?)", [name, description])
rescue SQLite3::Exception => e
  puts "Error adding post: #{e.message}"
end

# Function to display all posts
def display_posts(db)
  db.execute("SELECT * FROM posts") do |row|
    puts "Post Name: #{row[1]}, Description: #{row[2]}"
  end
rescue SQLite3::Exception => e
  puts "Error displaying posts: #{e.message}"
end

# Example usage
add_malware_sample(db, 'ILOVEYOU', 'Email Worm', 'A computer worm that spread through email attachments.')
add_malware_sample(db, 'Conficker', 'Worm', 'A worm that targets Microsoft Windows operating systems.')

# Command-line interface
puts "Welcome to the malware database! Here you can learn about different types of malware and how to protect against them."
puts "Type 'help' for a list of commands."

def malware_db_shell(db)
  loop do
    print "malwareDB> "
    input = gets.chomp.strip

    case input
    when ''
    when 'help'
      puts "Available commands:"
      puts "help - Show this help message"
      puts "types - List types of malware"
      puts "info <type> - Get information about a type of malware"
      puts "search <type> - Search for malware by type"
      puts "malwareDBworld - Enter the malwareDBworld mode"
      puts "exit - Exit the malware database CLI"
    when 'types'
      puts "Viruses, Worms, Ransomware, Bots, Trojan horses, Keyloggers, Rootkits, Spyware"
    when /^info (.+)$/
      type = $1.downcase
      case type
      when 'viruses'
        puts "Viruses: Malicious software that attaches itself to a host file and spreads when the file is executed."
        puts "Examples: Boot Sector Virus, Web Scripting Virus, Browser Hijacker, Resident Virus, Direct Action Virus, Polymorphic Virus, File Infector Virus, Multipartite Virus, Ebola"
      when 'worms'
        puts "Worms: Standalone malware that replicates itself to spread to other computers."
        puts "Examples: Email worms, Instant Messaging worms, ILOVEYOU, Storm Worm, SQL Slammer, Conficker, CryptoLocker, WannaCry ransomware attack, Mydoom, Tapeworm"
      when 'ransomware'
        puts "Ransomware: Malware that encrypts the victim's data and demands a ransom for the decryption key."
        puts "Examples: CryptoLocker, Bad Rabbit, NotPetya (Petya), Cerber, WannaCry, Dharma (CrySiS), Maze"
      when 'bots'
        puts "Bots: Malware that allows an attacker to take control of an infected computer."
        puts "Examples: Fireball"
      when 'trojan horses'
        puts "Trojan horses: Malware disguised as legitimate software to trick users into installing it."
        puts "Examples: Downloader Trojan, Backdoor Trojan, Spyware, Rootkit Trojans, DDoS Attack Trojan (Botnet), Zeus, ILOVEYOU, Cryptolocker"
      when 'keyloggers'
        puts "Keyloggers: Malware that records keystrokes to steal sensitive information like passwords."
        puts "Examples: Hardware keyloggers, Software keyloggers, Actual Keylogger, Spyrix Free Keylogger, Elite Keylogger, KidLogger, Acoustic keyloggers, Ardamax Keylogger, Best Free Keylogger"
      when 'rootkits'
        puts "Rootkits: Malware designed to gain unauthorized access to a computer and hide its presence."
        puts "Examples: Kernel mode rootkits, Firmware rootkits, User-mode rootkit, Bootloader rootkit, Stuxnet, Bootkit, Keyloggers, Ransomware, Sony BMG"
      when 'spyware'
        puts "Spyware: Malware that secretly monitors and collects information about a user's activities."
        puts "Examples: Keyloggers, Adware, Tracking cookies, System monitors"
      else
        puts "Unknown malware type. Available types: Viruses, Worms, Ransomware, Bots, Trojan horses, Keyloggers, Rootkits, Spyware"
      end
    when /^search (.+)$/
      type = $1
      search_malware_by_type(db, type)
    when 'malwareDBworld'
      malware_db_world_shell(db)
    when 'exit'
      puts "Exiting the malware database. Goodbye!"
      break
    else
      puts "Unknown command. Type 'help' for a list of commands."
    end
  end
end

def malware_db_world_shell(db)
  puts "Welcome to malwareDBworld! Here you can share and read posts about malware analysis and experiences with the malware database."
  puts "Type '?' for a list of commands."

  loop do
    print "malwareDBworld> "
    input = gets.chomp.strip

    case input
    when ''
    when '?'
      puts "Available commands:"
      puts "? - Show this help message"
      puts "posts - Display all posts"
      puts "makepost - Create a new post"
      puts "exit - Exit malwareDBworld"
    when 'posts'
      display_posts(db)
    when 'makepost'
      print "Post name: "
      post_name = gets.chomp.strip
      print "Post description: "
      post_description = gets.chomp.strip
      add_post(db, post_name, post_description)
      puts "Post added successfully!"
    when 'exit'
      puts "Exiting malwareDBworld."
      break
    else
      puts "Unknown command. Type '?' for a list of commands."
    end
  end
end

malware_db_shell(db)
